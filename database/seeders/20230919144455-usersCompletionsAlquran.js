const fs = require('fs')
const csv = require('csv-parser')

module.exports = {
  async up(queryInterface, Sequelize) {
    const materials = {
      "1": 2216,
      "10": 2225,
      "100": 2557,
      "101": 2558,
      "102": 2559,
      "103": 2560,
      "104": 2561,
      "105": 2562,
      "106": 2563,
      "107": 2564,
      "108": 2565,
      "109": 2566,
      "11": 2226,
      "110": 2567,
      "111": 2568,
      "112": 2569,
      "113": 2570,
      "114": 2571,
      "115": 2572,
      "116": 2573,
      "117": 2574,
      "118": 2575,
      "119": 2576,
      "12": 2227,
      "120": 2577,
      "121": 2578,
      "122": 2579,
      "123": 2580,
      "124": 2581,
      "125": 2582,
      "126": 2583,
      "127": 2584,
      "128": 2585,
      "129": 2586,
      "13": 2228,
      "130": 2587,
      "131": 2588,
      "132": 2589,
      "133": 2590,
      "134": 2591,
      "135": 2592,
      "136": 2593,
      "137": 2594,
      "138": 2595,
      "139": 2596,
      "14": 2229,
      "140": 2597,
      "141": 2598,
      "142": 2599,
      "143": 2600,
      "144": 2601,
      "145": 2602,
      "146": 2603,
      "147": 2604,
      "148": 2605,
      "149": 2606,
      "15": 2230,
      "150": 2607,
      "151": 2608,
      "152": 2609,
      "153": 2610,
      "154": 2611,
      "155": 2612,
      "156": 2613,
      "157": 2614,
      "158": 2615,
      "159": 2616,
      "16": 2231,
      "160": 2617,
      "161": 2618,
      "162": 1130,
      "163": 1131,
      "164": 1132,
      "165": 1133,
      "166": 1134,
      "167": 1135,
      "168": 1136,
      "169": 1137,
      "17": 2232,
      "170": 1138,
      "171": 1139,
      "172": 1140,
      "173": 1141,
      "174": 1142,
      "175": 1143,
      "176": 1144,
      "177": 1145,
      "178": 1146,
      "179": 1147,
      "18": 2233,
      "180": 1148,
      "181": 1149,
      "182": 1150,
      "183": 1151,
      "184": 1152,
      "185": 1153,
      "186": 1154,
      "187": 1155,
      "188": 1156,
      "189": 1157,
      "19": 2234,
      "190": 1158,
      "191": 1159,
      "192": 1160,
      "193": 1161,
      "194": 1162,
      "195": 1163,
      "196": 1164,
      "197": 1165,
      "198": 1166,
      "199": 1167,
      "2": 2217,
      "20": 2235,
      "200": 1168,
      "201": 1169,
      "202": 1170,
      "203": 1171,
      "204": 1172,
      "205": 1173,
      "206": 1174,
      "207": 1175,
      "208": 1176,
      "209": 1177,
      "21": 2236,
      "210": 1178,
      "211": 1179,
      "212": 1180,
      "213": 1181,
      "214": 1182,
      "215": 1183,
      "216": 1184,
      "217": 1185,
      "218": 1186,
      "219": 1187,
      "22": 2237,
      "220": 1188,
      "221": 1189,
      "222": 1190,
      "223": 1191,
      "224": 1192,
      "225": 1193,
      "226": 1194,
      "227": 1195,
      "228": 1196,
      "229": 1197,
      "23": 2238,
      "230": 1198,
      "231": 1199,
      "232": 1200,
      "233": 1201,
      "234": 1202,
      "235": 1203,
      "236": 1204,
      "237": 1205,
      "238": 1206,
      "239": 1207,
      "24": 2239,
      "240": 1208,
      "241": 1209,
      "242": 1513,
      "243": 1514,
      "244": 1515,
      "245": 1516,
      "246": 1517,
      "247": 1518,
      "248": 1519,
      "249": 1520,
      "25": 2240,
      "250": 1521,
      "251": 1522,
      "252": 1523,
      "253": 1524,
      "254": 1525,
      "255": 1526,
      "256": 1527,
      "257": 1528,
      "258": 1529,
      "259": 1530,
      "26": 2241,
      "260": 1531,
      "261": 1532,
      "262": 1533,
      "263": 1534,
      "264": 1535,
      "265": 1536,
      "266": 1537,
      "267": 1538,
      "268": 1539,
      "269": 1540,
      "27": 2242,
      "270": 1541,
      "271": 1542,
      "272": 1543,
      "273": 1544,
      "274": 1545,
      "275": 1546,
      "276": 1547,
      "277": 1548,
      "278": 1549,
      "279": 1550,
      "28": 2243,
      "280": 1551,
      "281": 1552,
      "282": 1553,
      "283": 1554,
      "284": 1555,
      "285": 1556,
      "286": 1557,
      "287": 1558,
      "288": 1559,
      "289": 1560,
      "29": 2244,
      "290": 1561,
      "291": 1562,
      "292": 1563,
      "293": 1564,
      "294": 1565,
      "295": 1566,
      "296": 1567,
      "297": 1568,
      "298": 1569,
      "299": 1570,
      "3": 2218,
      "30": 2245,
      "300": 1571,
      "301": 1572,
      "302": 1573,
      "303": 1574,
      "304": 1575,
      "305": 1576,
      "306": 1577,
      "307": 1578,
      "308": 1579,
      "309": 1580,
      "31": 2246,
      "310": 1581,
      "311": 1582,
      "312": 1583,
      "313": 1584,
      "314": 1585,
      "315": 1586,
      "316": 1587,
      "317": 1588,
      "318": 1589,
      "319": 1590,
      "32": 2247,
      "320": 1591,
      "321": 1592,
      "322": 1854,
      "323": 1855,
      "324": 1856,
      "325": 1857,
      "326": 1858,
      "327": 1859,
      "328": 1860,
      "329": 1861,
      "33": 2248,
      "330": 1862,
      "331": 1863,
      "332": 1864,
      "333": 1865,
      "334": 1866,
      "335": 1867,
      "336": 1868,
      "337": 1869,
      "338": 1870,
      "339": 1871,
      "34": 2249,
      "340": 1872,
      "341": 1873,
      "342": 1874,
      "343": 1875,
      "344": 1876,
      "345": 1877,
      "346": 1878,
      "347": 1879,
      "348": 1880,
      "349": 1881,
      "35": 2250,
      "350": 1882,
      "351": 1883,
      "352": 1884,
      "353": 1885,
      "354": 1886,
      "355": 1887,
      "356": 1888,
      "357": 1889,
      "358": 1890,
      "359": 1891,
      "36": 2251,
      "360": 1892,
      "361": 1893,
      "362": 1894,
      "363": 1895,
      "364": 1896,
      "365": 1897,
      "366": 1898,
      "367": 1899,
      "368": 1900,
      "369": 1901,
      "37": 2252,
      "370": 1902,
      "371": 1903,
      "372": 1904,
      "373": 1905,
      "374": 1906,
      "375": 1907,
      "376": 1908,
      "377": 1909,
      "378": 1910,
      "379": 1911,
      "38": 2253,
      "380": 1912,
      "381": 1913,
      "382": 1914,
      "383": 1915,
      "384": 1916,
      "385": 1917,
      "386": 1918,
      "387": 1919,
      "388": 1920,
      "389": 1921,
      "39": 2254,
      "390": 1922,
      "391": 1923,
      "392": 1924,
      "393": 1925,
      "394": 1926,
      "395": 1927,
      "396": 1928,
      "397": 1929,
      "398": 1930,
      "399": 1931,
      "4": 2219,
      "40": 2255,
      "400": 1932,
      "401": 1933,
      "402": 275,
      "403": 276,
      "404": 277,
      "405": 278,
      "406": 279,
      "407": 280,
      "408": 281,
      "409": 282,
      "41": 2256,
      "410": 283,
      "411": 284,
      "412": 285,
      "413": 286,
      "414": 287,
      "415": 288,
      "416": 289,
      "417": 290,
      "418": 291,
      "419": 292,
      "42": 2257,
      "420": 293,
      "421": 294,
      "422": 295,
      "423": 296,
      "424": 297,
      "425": 298,
      "426": 299,
      "427": 300,
      "428": 301,
      "429": 302,
      "43": 2258,
      "430": 303,
      "431": 304,
      "432": 305,
      "433": 306,
      "434": 307,
      "435": 308,
      "436": 309,
      "437": 310,
      "438": 311,
      "439": 312,
      "44": 2259,
      "440": 313,
      "441": 314,
      "442": 315,
      "443": 316,
      "444": 317,
      "445": 318,
      "446": 319,
      "447": 320,
      "448": 321,
      "449": 322,
      "45": 2260,
      "450": 323,
      "451": 324,
      "452": 325,
      "453": 326,
      "454": 327,
      "455": 328,
      "456": 329,
      "457": 330,
      "458": 331,
      "459": 332,
      "46": 2261,
      "460": 333,
      "461": 334,
      "462": 611,
      "463": 612,
      "464": 613,
      "465": 614,
      "466": 615,
      "467": 616,
      "468": 617,
      "469": 618,
      "47": 2262,
      "470": 619,
      "471": 620,
      "472": 621,
      "473": 622,
      "474": 623,
      "475": 624,
      "476": 625,
      "477": 626,
      "478": 627,
      "479": 628,
      "48": 2263,
      "480": 629,
      "481": 630,
      "482": 631,
      "483": 632,
      "484": 633,
      "485": 634,
      "486": 635,
      "487": 636,
      "488": 637,
      "489": 638,
      "49": 2264,
      "490": 639,
      "491": 640,
      "492": 641,
      "493": 642,
      "494": 643,
      "495": 644,
      "496": 645,
      "497": 646,
      "498": 647,
      "499": 648,
      "5": 2220,
      "50": 2265,
      "500": 649,
      "501": 650,
      "502": 651,
      "503": 652,
      "504": 653,
      "505": 654,
      "506": 655,
      "507": 656,
      "508": 657,
      "509": 658,
      "51": 2266,
      "510": 659,
      "511": 660,
      "512": 661,
      "513": 662,
      "514": 663,
      "515": 664,
      "516": 665,
      "517": 666,
      "518": 667,
      "519": 668,
      "52": 2267,
      "520": 669,
      "521": 670,
      "522": 865,
      "523": 866,
      "524": 867,
      "525": 868,
      "526": 869,
      "527": 870,
      "528": 871,
      "529": 872,
      "53": 2268,
      "530": 873,
      "531": 874,
      "532": 875,
      "533": 876,
      "534": 877,
      "535": 878,
      "536": 879,
      "537": 880,
      "538": 881,
      "539": 882,
      "54": 2269,
      "540": 883,
      "541": 884,
      "542": 885,
      "543": 886,
      "544": 887,
      "545": 888,
      "546": 889,
      "547": 890,
      "548": 891,
      "549": 892,
      "55": 2270,
      "550": 893,
      "551": 894,
      "552": 895,
      "553": 896,
      "554": 897,
      "555": 898,
      "556": 899,
      "557": 900,
      "558": 901,
      "559": 902,
      "56": 2271,
      "560": 903,
      "561": 904,
      "562": 905,
      "563": 906,
      "564": 907,
      "565": 908,
      "566": 909,
      "567": 910,
      "568": 911,
      "569": 912,
      "57": 2272,
      "570": 913,
      "571": 914,
      "572": 915,
      "573": 916,
      "574": 917,
      "575": 918,
      "576": 919,
      "577": 920,
      "578": 921,
      "579": 922,
      "58": 2273,
      "580": 923,
      "581": 924,
      "582": 229,
      "583": 230,
      "584": 231,
      "585": 232,
      "586": 233,
      "587": 234,
      "588": 235,
      "589": 236,
      "59": 2274,
      "590": 237,
      "591": 238,
      "592": 239,
      "593": 240,
      "594": 241,
      "594": 180,
      "595": 181,
      "596": 182,
      "597": 183,
      "598": 184,
      "599": 185,
      "6": 2221,
      "60": 2275,
      "600": 186,
      "601": 187,
      "602": 188,
      "603": 189,
      "604": 190,
      "61": 2276,
      "62": 2277,
      "63": 2278,
      "64": 2279,
      "65": 2280,
      "66": 2281,
      "67": 2282,
      "68": 2283,
      "69": 2284,
      "7": 2222,
      "70": 2285,
      "71": 2286,
      "72": 2287,
      "73": 2288,
      "74": 2289,
      "75": 2290,
      "76": 2291,
      "77": 2292,
      "78": 2293,
      "79": 2294,
      "8": 2223,
      "80": 2295,
      "81": 2296,
      "82": 2539,
      "83": 2540,
      "84": 2541,
      "85": 2542,
      "86": 2543,
      "87": 2544,
      "88": 2545,
      "89": 2546,
      "9": 2224,
      "90": 2547,
      "91": 2548,
      "92": 2549,
      "93": 2550,
      "94": 2551,
      "95": 2552,
      "96": 2553,
      "97": 2554,
      "98": 2555,
      "99": 2556,
    }

    const now = Date.now()

    const parseCsv = (line) => {
      return {
        userId: line.id,
        materialId: line.materialId,
        createdAt: now,
      }
    }

    const data = await new Promise((resolve, reject) => {
      const rows = []
      const filePath = 'files/users-completions-alquran.csv'
      const readStream = fs.createReadStream(filePath)
      readStream.pipe(csv())
        .on('data', (line) => {
          const completedArray = JSON.parse(line.completed)
          completedArray.forEach(materialId => {
            line.materialId = materials[materialId]
            rows.push(parseCsv(line))
          })
        })
        .on('end', () => {
          resolve({ rows })
        })
        .on('error', (err) => {
          reject(err)
        })
    })
    await queryInterface.bulkInsert('usersCompletions', data.rows)
  }
}
